name: feature-bugfix
on: 
  workflow_dispatch:
  pull_request:
    branches:    
      - develop
      
jobs:
  swiftlint:
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: SwiftLint (Only files changed in the PR)
        uses: norio-nomura/action-swiftlint@3.2.1
        env:
          DIFF_BASE: ${{ github.base_ref }}
  
  test-unit:
    name: Unit Test
    needs: swiftlint
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: xcodebuild Test
        uses: sersoft-gmbh/xcodebuild-action@v2.1
        with:
          project: GithubActionDemo.xcodeproj
          scheme: GithubActionDemo
          destination: platform=iOS Simulator
          output-formatter: xcbeautify
          action: clean test

  build-archive:
    name: Archive
    needs: test-unit
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: xcodebuild Archive
        uses: sersoft-gmbh/xcodebuild-action@v2.1
        with:
          project: GithubActionDemo.xcodeproj
          scheme: GithubActionDemo
          sdk: iphoneos
          output-formatter: xcbeautify
          action: clean archive